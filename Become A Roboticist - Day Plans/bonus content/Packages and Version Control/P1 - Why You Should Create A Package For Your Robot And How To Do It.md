Eventually every complex system needs to be broken down into components. It could be because you want to share it with someone else, or maybe you have decided that you only want to share part of your robots code, and keep another part seperate. 

Once you start sharing or breaking down your robot system, you're going to need to describe to your future self or someone else how to set it up, what it requires and how to build it.

The ROS package system gives you a template and ecosystem of tools to do just that. Today we will look into the most basic part, how to create a package. 

Most courses start by showing you how to create a package. It seems like the most fundamental thing you can do with ROS. But I think that the best part of ROS is that there are other packages that you can use, so that's why we are keeping this as a seperate bonus module. 

It's also quite easy to gloss over creating packages, and think to yourself that you will never need it. Perhaps you always work alone and on the same computer, so your system is always ready. I've found that this nearly never works out, and sooner or later, you'll need to rebuild your system, and you'll be thankful that you spent the (very small effort) setting up a package. 

You trap to lookout for is not configuring your CMakeLists after you've run the ros2 package step. You need to ROS know about your launch folder, config folders and executable folders in the CMakeListst.txt file, otherwise they won't be available when you try to autocomplete with tab for running commands.

## What colcon build does

The ROS package system is built around colcon build, and now you're building your own packages its important to understand what happens. 

Basically `colcon build` creates three new folders in your workspace, `build`, `install` and `log`. 

The `log` directory just contains logs from the build and also logs when you run your robot system. 

The `build` directory contains intermediate files used by colcon when building the package. For C++ this could involve autogenerated template generation. Usually we don't care too much what happens in this directory. 

The `install` directory is where the magic happens. When things are finished building, their output is placed in the install directory, and this is where your ROS system will look for things. This is why the command `source install/setup.bash` is so important, as it tells your shell about all the important files and packages that are installed into the `install` folder.

When ROS complains that it can't find something, it can often mean that it can't find it in the `install` folder, not the `src` folder. This has tripped me up more than once! 

## Action steps 

1. Run the command "ros2 pkg help" to see the help message 
2. Change into the `src` directory and create a new package using the command `ros2 pkg create --build-type ament_cmake my_robot --dependencies rclpy ` this will create a new package called "my_robot"
3. Look at the new files that were created, particularly package.xml and CMakeLists.txt
4. Add some directories to be copied over to the share folder when the package is installed
5. Add some executables to be run
6. Add some package dependencies
7. run `colcon build --merge-install --symlink-install` to build the package
8. Run `source install/setup.bash` to add the new package path to your shell 
9. Try using your package. 

##  I'm writing a python node, should I use ament-python instead? 

Some of the official docs suggest this, but I've found it not very useful. The `ament-python` bulid type adds a `setup.py` script, which is an old way of building python commands, and it provides a very clunky interface for moving things into the `share` directory (such as launch and config files). Even though `ament-cmake` is for building `C++` files, you can easily use it with python. The only thing is you need to make sure the python script is executable, but that is very trivial. 

# I can't seem to run my package 

There can be a few root causes for this. 

If you haven't run `colcon build` then you're package won't be in the `install` folder. 

If you haven't run `source install/setup.bash` then your shell won't know where to look for the package. 

And if you haven't updated your CMakeLists.txt file, then the file may not actually be in the `install` folder anyway. 

Finally, if there is a syntax error in `package.xml`, this can be really hard to track down. `colcon` can sometimes just skip a package silently, and so I'd also check that there aren't any errors there as well. 


## Here's a quick video to show you how its done


https://youtu.be/ZF_JLcMhiZ4
